## 14장 리팩터링: 기존의 코드를 성장시키는 기술

> **리팩터링이란?**
> 실질적인 동작은 유지하면서, 구조만 정리하는 작업

### 리팩터링의 흐름

리팩터링을 하기 위해 코드를 변경할 때 실질적인 동작까지 바뀌어 버린다면, 이는 리팩터링이라 할 수 없습니다.

 1. 중첩을 제거하여 보기 좋게 만들기
 2. 의미 단위로 로직 정리하기
 3. 조건을 읽기 쉽게 하기
 4. 무턱대고 작성한 로직을 목적을 나타내는 메서드로 바꾸기

### 단위 테스트로 리팩터링 중 실수 방지하기

> 리팩터링을 할 때 단위 테스트는 필수다!

테스트 코드를 사용한 리팩터링 흐름

1. 이상적인 구조의 클래스 기본 형태를 어느 정도 잡습니다.
2. 이 기본 형태를 기반으로 테스트 코드를 작성합니다.
3. 테스트를 실패시킵니다.
4. 테스트를 성공시키기 위한 최소한의 코드를 작성합니다.
5. 기본 형태의 클래스 내부에서 리팩터링 대상 코드를 호출합니다.
6. 테스트가 성공할 수 있도록, 조금씩 로직을 이상적인 구조로 리팩터링합니다.

### 불확실한 사양을 이해하기 위한 분석 방법

1. 문서화 테스트
   - 문서화 테스트는 매서드의 사양을 분석하는 방법입니다.
   - 분석하고 싶은 메서드읭 테스트를 작성해서, 해당 메서드가 어떤 동작을 하는지 확인하는 방법
2. 스크래치 리팩터링
   - 로직의 의미와 구조를 분석하기 위해 시험 삼아 리팩터링하는 것
   - 코드의 가독성이 좋아져 로직의 사양을 이해할 수 있게 됩니다.
   - 이상적인 구조가 보입니다.
   - 쓸데없는 코드가 보입니다.
   - 테스트 코드를 어떻게 작성해야 할지 보입니다.
   - 스크래치 리팩터링은 어디까지나 분석용이므로, 리포지터리에 병합해서는 안됩니다.

### 리팩터링 시 주의 사항

1. 기능 추가와 리팩터링 동시에 하지 않기
2. 작은 단계로 실시하기
3. 불필요한 사양은 제거 고려하기


## 15장 설계의 의의와 설계를 대하는 방법

### 설계하지 않으면 개발 생산성이 저하된다

변경하기 어렵고 버그가 생기기 쉬운 코드를 **레거시 코드**라고 합니다. 그리고 레거시 코드가 축적되어 있는 상태를 **기술 부채**라고 합니다.

저하 요인으로는 크게 두가지가 있습니다.

1. 요인1: 버그가 발생하기 쉬운 구조
2. 요인2: 가독성이 낮은 구조

> **나무꾼의 딜레마**   
> 나무꾼이 도끼로 열심히 나무를 베고 있었습니다.    
> 지나가던 여행자가 그 모습을 보고 있는데, 나무가 잘 베이지 않았습니다.    
> 잘 보니 도끼의 날이 너무 무딘 것 같아서 여행자가 말했습니다.   
> "도끼를 갈고 나무를 베는 것이 좋지 않을까요?"    
> 나무꾼은 대답했습니다.    
> "알고 있지만, 나무를 베는 것이 바빠서 도끼를 갈 시간이 없어요!"

제대로 설계하지 않으면, 로직 변경과 디버그에 많은 시간을 소비하게 됩니다.

결국 설계할 시간 여유조차 없어지는 딜레마에 빠지게 됩니다.

### 소프트웨어와 엔지니어의 성장 가능성

엔지니어에게 `자산`이란 무엇일까요?   
엔지니어가 기술력이 있다면, 모아 놓은 돈이 없어도 어디서든 돈을 벌 수 있습니다. 따라서 기술력은 엔지니어가 부를 창출하는 원천이라고 이야기 할 수 있습니다.

그런데 레거시 코드는 이러한 자산의 축적, 즉 기술력의 성장을 방해하는 무서운 존재입니다.

> 레거시 코드는 엔지니어의 기술 성장도 막고, 연봉 인상도 막는 것입니다

### 문제 해결하기

1. 문제를 인식하지 못하면 설계에 대한 생각 자체가 떠오르지 않음
2. 인지하기 쉬운 문제와 인지하기 어려운 문제가 있음
3. 이상적인 형태를 알아야 문제를 인식할 수 있음
4. 변경 용이성을 비교할 수 없는 딜레마

### 코드의 좋고 나쁨을 판단하는 지표

> 코드 복잡성과 가독성 등의 품질 지표를 코드 메트릭 또는 소프트웨어 메트릭 이라고 부릅니다.

1. 실행되는 코드의 줄 수
   - 줄 수가 너무 많으면 메서드와 클래스 분할을 검토해 보십시오
2. 순환 복잡도
3. 응집도
   - 응집도가 높을 수록 변경 용이성이 높고 좋은 구조입니다. 응집도를 나타내는 메트릭으로 LCOM이 있습니다.
4. 결합도
5. 청크

### 설계 대상과 비용 대비 효과




