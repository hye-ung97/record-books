## 6장 의존관계

### 의존의 강도: 결합도

> **결합도란**
>
> 클래스 간의 상호 의존 정도 또는 연관관계의 끈끈함 정도를 나태내는 지표입니다.

코드의 가독성, 견고함, 유지보수성을 유지하기 위해서 보다 약한 결합을 사용해야 합니다.

#### 내용결합

가장 높은 결합도를 가진 내용결합이 발생하는 경우

1. 사용되는 쪽 틀래스의 코드를 변경한다.
2. 사용되는 쪽 클래스에 은닉된 변수를 외부에서 참조한다.
3. 사용되는 쪽 클래스 안에 있는 코드로 직접 점프 한다.

애초에 안전한 방법으로만 사용해야 하는 코드가 더욱 가독성이 높고 견고합니다.

제약이 많아지면 호출하는 쪽의 코드를 변경할 때 예기치 않게 잘못된 방법으로 사용될 수 있습니다.

책임의 주체를 명확히 하면 변수의 상태 전이를 관리하기가 더 수월해집니다. 결과적으로 잘못된 상태 전이가 일어날 가능성을 낮추고, 설령 버그가 발생하더라도 이를 조사하기가 쉬워집니다.

#### 공통 결합과 외부 결합

이 두가지는 누구나 읽기/쓰기가 가능한 곳에서 값을 주고 받을 때 발생합니다.

발생하는 대표적인 예)

1. 전역 변수를 사용하여 값을 전달할 때
2. 가변 싱글턴 객체를 사용할 때
3. I/O, 공유 메모리와 같이 코드에서 단일하게 취급하는 외부 리소스를 이용 할 때


단일하게 취급되는 외부 리소스를 꼭 필요한 경우에만 사용한다면 문제가 되지 않습니다.

공통 결합과 외부 결합은 전달하는 값의 종류에 따라 구분됩니다.

- 공통 결합: 전달하는 값이 일종의 자료 구조를 가지고 있음
- 외부 결합: Int 와 같이 기본적인 단일 데이터

#### 제어 결합

> **제어 결합이란?**
>
> 무엇을 할 것인지 결정하는 값을 전달하여 호출 대상의 동작을 변경하는 경우에 발생 한다.

#### 스탬프 결합과 데이터 결합

스탬프 결합과 데이터 결합은 모두 **결합도가 낮습니다.**

이 두 결합은 함수의 인수나 반환값으로 값을 전달할 때, 그리고 그것이 제어 결합이 아닐 때 발생합니다.

#### 메시지 결합

인수나 반환값 등으로 정보를 전달하지 않고 단순히 함수만을 호출할 때 발생

### 의존 방향

#### 호출자 -> 호출 대상

의존 관계를 단방향으로 만들기 위해서라도 불필요한 콜백은 없어야 합니다. 하지만 상황에 따라서는 의존 관계에 순환이 만들어져도 콜백이 유효하게 작동되는 경우가 있습니다.

알고리즘을 추상화하기 위한 동기식 콜백의 사용은 허용됩니다.

비동기식 콜백은 가독성을 떨어뜨리고 리소스 누수의 원인이 될 수 있기 때문에 사용하는 목적, 수명주기, 사용 범위를 제한하는 것이 좋습니다.

#### 구체적 -> 추상적

클래스 두 개가 상속 관계에 있을 때 자식 클래스와 부모 클래스의 관계는 각각 `사용하는 관계`와 `사용되는 관계`가 됩니다.

#### 복잡/가변 -> 단순/불변

사용되는 범위, 수명 주기, 참조하는 곳의 수가 제각각이라는 특징을 가집니다. 

### 의존의 중복

#### 연결된 의존 관계

단순히 어떤 참조를 전달받기 위한 이유만으로 서로 관련이 없는 클래스가 의존해서는 안 됩니다.

#### 디미터의 법칙

디미터의 법칙은 메서드 내에서 객체의 멤버에 접근할 때 수신 객체는 다음 중 하나로 제한되어야 한다고 주장합니다.

 1. this 자신
 2. this 의 프로퍼티
 3. 메서드의 인수
 4. 메서드 내에서 생성된 객체
 5. 전역 변수 및 싱글톤

디미터의 법칙을 적용할 때는 형식적인 것에 불과한 회피 방법을 택하지 말고, 각 클래스가 알아야 할 정보와 알지 말아야 할 정보가 무엇인지를 구분하여 설계하는 것이 바람직합니다.

#### 의존 대상 집합의 중복

아직 의존 대상이 하나밖에 없는데 `앞으로 늘어날지도 모른다`는 이유로 중간 레이어를 만들어서는 안됩니다.

사용 여부를 알 수 없는 중간 레이어는 코드의 가독성을 떨어뜨리는 원인이 될 수 있기 때문입니다.

중간 레이어를 만드는 타이밍은 실제로 코드의 중복이 발생했을 때가 좋습니다.

### 의존의 명시성

암묵적 의존 관계가 존재하면 코드의 전체 구조를 파악하기 어려워 가독성을 떨어뜨리기 쉽습니다.

추상화는 가독성을 향상시키는 효과적인 수단 중 하나이지만, 동시에 암묵적 의존 관계의 원인이 되기도 합니다.
